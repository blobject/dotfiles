#! /usr/bin/env tclsh

###############################################################################
# 0l: desktop utility for reading logs (presumes socklog on void)

source $::env(HOME)/bin/lib.tcl

###############################################################################

set arg [lindex $::argv 0]
set dir /var/log/socklog
set what {_}
set dmesg false

proc help {} {
  ufail {[what]
  _             o
  user session  old user session
  a   b     d      e      k      l     m    s      u    p
  all debug daemon errors kernel dmesg msgs secure user xbps}
}

switch -- $arg {
  {} - w - wayland - x - xorg - wm - o - old {
    set dir $::env(HOME)/log
    set what wayland.log
    if {{x} eq $SESS} { set what x.log }
    if {{o} eq [string index $arg 0]} { set what "$what.old" }
  }
  l - dmesg    { set dmesg true }
  a - all      { set what everything }
  b - debug    { set what debug }
  d - daemon   { set what daemon }
  e - errors   { set what errors }
  k - kernel   { set what kernel }
  m - messages { set what messages }
  p - xbps     { set what xbps }
  s - secure   { set what secure }
  u - user     { set what user }
}

if {[string match "*/$::env(USER)/log" $dir]} {
  exec -- >@stdout 2>@stdout less $dir/$what
} elseif {$dmesg} {
  exec -- >@stdout 2>@stdout /usr/bin/sudo /usr/bin/dmesg | less
} elseif {[file isdirectory $dir/$what]} {
  exec -- >@stdout 2>@stdout less $dir/$what/current
} else {
  help
}

