#! /usr/bin/env tclsh

###############################################################################
# 0l: desktop utility for reading logs (presumes socklog on void)

source $::env(HOME)/bin/lib.tcl

###############################################################################

set dir /var/log/socklog
set what wayland.log
set dmesg false
set arg [lindex $::argv 0]

proc help {} {
  ufail {[shortname|longname]
  a all
  b debug
  d daemon
  e errors
  k kernel
  l dmesg
  m messages
  s secure
  u user
  x xbps}
}

switch -- $arg {
  {} - w - x - wayland - wm - xorg {
    set dir $::env(HOME)/log
    if {{x} eq $SESS} { set what x.log }
  }
  a - all      { set what everything/current }
  b - debug    { set what debug/current }
  d - daemon   { set what daemon/current}
  e - errors   { set what errors/current }
  k - kernel   { set what kernel/current }
  l - dmesg    { set dmesg true }
  m - messages { set what messages/current }
  s - secure   { set what secure/current }
  u - user     { set what user/current }
  x - xbps     { set what xbps/current }
  default      { help }
}

try {
  if {$dmesg} {
    exec -- >/dev/tty 2>/dev/tty /usr/bin/sudo /usr/bin/dmesg | less
  } else {
    exec -- >/dev/tty 2>/dev/tty less $dir/$what
  }
} on error e { puts stderr "$e"; help }

